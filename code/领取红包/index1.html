<!DOCTYPE html>
<html lang="en" class="hongbao">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="format-detection" content="telephone=no,email=no,adress=no"/>
    <title>红包</title>
    <link rel="stylesheet" href="css/reset.css"/>
    <link rel="stylesheet" href="css/kaojuan.css"/>
    <script src="js/mediaquery2.js"></script>
    <script src="js/zepto.min.js"></script>
    <script src="js/moment.min.js"></script>
</head>
<body class="kaojuan">
<section class="bigwrap">
    <section class="header">
        <div class="juanzi"></div>
        <h3>你已获得密卷考题<span></span>道</h3>
        <a href="javascript:;" class="lingqu">点击领取</a>
    </section>
    <section class="content">
        <p><span>4</span>个红包，<em>2</em>分钟被抢光</p>
        <div class="list flex ac">
            <img src="images/photo.gif" alt="" class="touxiang">
            <div class="middle flex col">
                <span>张小娟</span>
                <em>4月6日 12:23:23</em>
            </div>
            <em>《护考金卷》一套</em>
        </div>
        <div class="list flex ac">
            <img src="images/photo2.gif" alt="" class="touxiang">
            <div class="middle flex col">
                <span>李灿</span>
                <em>4月6日 12:23:23</em>
            </div>
            <em>《模考现场》一套</em>
        </div>
        <div class="list flex ac">
            <img src="images/photo3.gif" alt="" class="touxiang">
            <div class="middle flex col">
                <span>李丽</span>
                <em>4月6日 12:23:23</em>
            </div>
            <em>密卷考题120道</em>
        </div>
        <div class="list flex ac">
            <img src="images/photo4.gif" alt="" class="touxiang">
            <div class="middle flex col">
                <span>周兵</span>
                <em>4月6日 12:23:23</em>
            </div>
            <em>密卷考题15道</em>
        </div>
    </section>
</section>
<footer>
    <p>你发红包我买单，给好友发红包即可再抢一次</p>
    <a href="javascript:;">叫大家来领红包</a>
</footer>
<section class="modal-wrap"></section>
<section class="modal">
    <span class="close"></span>
    <em class="chai"></em>
</section>
<section class="modal2">
    <span class="login-top"></span>
    <em class="close2"></em>
    <p class="info"> <span>为了礼品能准确的送给您</span> <br/><em></em><strong>请输入手机号</strong></p>
    <form>
        <input type="number" placeholder="请输入手机号码" class="text1" id="phone" name="phone">
        <div class="yanzheng">
            <input type="number" class="text2" id="verification" name="vertify">
            <input type="button" class="query" value="获取验证码">
        </div>
    </form>
    <a href="javascript:;" class="login">点击确认提交</a>    <!--注册-->
</section>
<section class="modal4">
    <span class="login-top"></span>
    <em class="close4"></em>
    <p class="gongxi">恭喜您</p>
    <div class="success">成功领取护考密卷一份</div>
    <a href="javascript:;" class="confirm">确定</a>
</section>
<section class="modal5">
    <span class="login-top"></span>
    <em class="close5"></em>
    <p class="info"> <span></span> <br/><em>欢迎您来到</em><strong>医护之家</strong></p>
    <input type="password" placeholder="请输入登录密码" id="pw" name="pwd">
    <p class="tishi">*密码错误 请重新输入</p>
    <a href="javascript:;" class="login2">确认登录并领取</a>   <!--老用户登录-->
</section>
<section class="modal6">
    <span class="login-top"></span>
    <em class="close6"></em>
    <p class="info"> <span></span> <br/><em>恭喜您成为</em><strong>医护之家会员</strong></p>
    <form>
        <input type="password" placeholder="请设置登录密码"  id="pw2" name="pw2">
        <input type="password" placeholder="请再次确认密码"  id="pw3" name="pw3">
    </form>
    <a href="javascript:;" class="login3">确认注册并领取</a>    <!--注册-->
</section>
<section class="modal-wrap7"></section>
<section class="modal7"></section>
<!--小菊花-->
<section class="loading-modal"></section>
<section class="loading"></section>
<section class="modal-wrap3"></section>
<section class="modal3">
    <p>提示</p>
    <p class="bianliang"></p>
    <p>确定</p>
</section>
</body>
</html>
<script>
    $(function(){
        var timu = [5,10,15,20,30,50,80,100,120];
        var message;
        var newtimu =[];
        //关闭红包
        $('.close').on('touchend',function(e){
            e.stopPropagation();
            hideModal();
            newtimu=shuffle(timu);
            message = newtimu.slice(0, 1);
            $('.header h3 span').html(message);

        });

        $('.close2').on('touchend',function(e){
            e.stopPropagation();
            hideModal2();
            clearform()
        });

        $('.close4').on('touchend',function(e){
            e.stopPropagation();
            hideModal4();
            clearform();
        });

        $('.close5').on('touchend',function(e){
            e.stopPropagation();
            hideModal5();
            clearform();
        });

        $('.close6').on('touchend',function(e){
            e.stopPropagation();
            hideModal6();
            clearform();
        });


        //拆红包
        $('.chai').on('touchend',function(e){
            e.stopPropagation();
            hideModal();
            newtimu=shuffle(timu);
            message = newtimu.slice(0, 1);
            $('.header h3 span').html(message);
        });

        //点击领取
        $('.lingqu').on('touchend',function(e){
            e.stopPropagation();
            showModal2();
        });

        //领取成功后确定退出
        $('.confirm').on('touchend',function(e){
            e.stopPropagation();
           //hideModal4();
            location.href = 'http://www.baidu.com';
        });

        /*获取验证码*/
        var isLock = false;
        var isvertify = false;
        var timer;
        var phone;
        var code;
        $('.query').on('touchend',function(e){
            e.stopPropagation();
            if(!checkPhone()){
                showModal3();
                $('.bianliang').html("手机号码位数不对");
                return;
            };
            if(isLock){
                return;
            };
            var phone = $('#phone').val();
             var code=404;
             if(code == 400){
             hideModal2();
             showModal5();
             $('.modal5 .info span').html(phone);
             isvertify = true;
             return;
             }
            /*$.ajax({
                url : 'http://192.168.0.76:8080/sms/get',
                type : 'post',
                async : true,
                data : {phone : phone,type : 'register'},
                dataType : 'json',
                //小菊花
                beforeSend: function(){
                    showloading()
                },
                complete:function(){
                    hideloading();
                },
                success : function(data){
                    if(data.code == 400){
                        hideModal2();
                        showModal5();
                        $('.modal5 .info span').html(phone);
                        isvertify = true;
                        return;
                    }
                }
            });*/
            var seconds = 300;
            $(".query").val(""+seconds+"S后重新获取");
           timer=setInterval(function(){
                seconds--;
                if(seconds < 1){
                    clearInterval(timer);
                    $('.query').val('获取验证码');
                    isLock = false;
                    return;
                }
                $(".query").val(""+seconds+"S后重新获取");
                isLock = true;
            },1000);
        });

        /*新用户注册1*/
        $('.login').on('touchend',function(e){
            e.stopPropagation();
            if(!checkPhone()){
                showModal3();
                $('.bianliang').html("手机号码位数不对");
                return;
            }
            if(!isvertify){
                if(!verificate()){
                    showModal3();
                    $('.bianliang').html("请输入6位验证码");
                    return;
                }
            }
            phone = $('#phone').val();
            code = $('#verification').val();

            $('.modal2').css('display','none');
            $('.modal6').css('display','block');
        });

        /*新用户注册2*/
        $('.login3').on('touchend',function(e){
            e.stopPropagation();
                if(!regverpwd()){
                    showModal3();
                    $('.bianliang').html("密码必须在6~16位");
                    return;
                }
                if(!regverpwd2()){
                    showModal3();
                    $('.bianliang').html("确认密码必须在6~16位");
                    return;
                }
                if(!isSamePwd()){
                    showModal3();
                    $('.bianliang').html("两次输入密码不一样");
                    return;
                }


                var password = $("#pw2").val();


                //使用ajax方法发请求
               /* $.ajax({
                    url : 'http://192.168.0.76:8080/baoguo/register',
                    type : 'post',
                    async : true,
                    data : {phone : phone,code : code,password :password},
                    dataType : 'json',
                    success : function(data){
                        console.log(data);
                        if(data.code == 200){
                            location.href = urladd;
                        }
                    },
                    //小菊花
                    beforeSend: function(){
                        showloading();
                    },
                    complete:function(){
                        hideloading();
                    }
                });*/

        });

        //老用户登录
        $('.login2').on("touchend",function(e){
            e.stopPropagation();
            if(!checkPhone()){
                showModal3();
                $('.bianliang').html("手机号码位数不对");
                return;
            }
            if(!verpwd1()){
                showModal3();
                $('.bianliang').html("输入密码不能为空");
                return;
            }
            if(!verpwd2()){
                showModal3();
                $('.bianliang').html("密码必须在6~16位");
                return;
            }

            var phone = $('#phone').val();
            var password = $("#pw").val();

            var code = 200;
            if(code == 200){
                hideModal5();
                showModal4();
            }else{
                $('.tishi').css('display','block')
            }

            /*$.ajax({
                url : 'http://192.168.0.76:8080/baoguo/login',
                type : 'post',
                async : true,
                data : {phone : phone,password :password},
                dataType : 'json',
                success : function(data){
                    console.log(data);
                    if(data.code == 200){
                        hideModal5();
                        showModal4();
                    }else{
                        $('.tishi').css('display','block')
                    }
                },
                //小菊花
                beforeSend: function(){
                    showloading()
                },
                complete:function(){
                    hideloading();
                }
            });*/
        });

        /*发红包*/
        $('footer a').on('touchend',function(e){
            e.stopPropagation();
            showModal7();
        });


        /*消除模态框*/
        $(document).on('touchend',function(e){
            hideModal3();
            hideModal7();
        });

        //弹出模态框
        function showModal(){
            $('.modal-wrap').css('display',"block");
            $('.modal').css('display',"block");
        };

        function showModal2(){
            $('.modal-wrap').css('display',"block");
            $('.modal2').css('display',"block");
        };

        //表单验证弹框
        function showModal3(){
            $('.modal-wrap3').css('display',"block");
            $('.modal3').css('display',"block");
        };

        function showModal4(){
            $('.modal-wrap').css('display',"block");
            $('.modal4').css('display',"block");
        };

        function showModal5(){
            $('.modal-wrap').css('display',"block");
            $('.modal5').css('display',"block");
        };

        function showModal7(){
            $('.modal-wrap7').css('display',"block");
            $('.modal7').css('display',"block");
        };

        //关闭模态框
        function hideModal(){
            $('.modal-wrap').css('display',"none");
            $('.modal').css('display',"none");
        };

        function hideModal2(){
            $('.modal-wrap').css('display',"none");
            $('.modal2').css('display',"none");
        };

        function hideModal3(){
            $('.modal-wrap3').css('display',"none");
            $('.modal3').css('display',"none");
        };

        function hideModal4(){
            $('.modal-wrap').css('display',"none");
            $('.modal4').css('display',"none");
        };

        function hideModal5(){
            $('.modal-wrap').css('display',"none");
            $('.modal5').css('display',"none");
        };

        function hideModal6(){
            $('.modal-wrap').css('display',"none");
            $('.modal6').css('display',"none");
        };

        function hideModal7(){
            $('.modal-wrap7').css('display',"none");
            $('.modal7').css('display',"none");
        };

        /*验证手机*/
        function checkPhone(){
            var phone = $('#phone').val();
            if(!(/^1[34578]\d{9}$/.test(phone))){
                return 0;
            }else{
                return 1;
            }
        }
        /*验证密码1 密码不能为空*/
        function verpwd1(){
            var pw = $('#pw').val();
            if(pw.length){
                return 1;
            }else{
                return 0;
            }
        }
        /*验证密码2,6到16位数字字母下划线*/
        function verpwd2(){
            var pw = $('#pw').val();
            if((/^.{6,16}$/.test(pw))){
                return 1;
            }else{
                return 0;
            }
        }
        function regverpwd(){
            var pw2 = $('#pw2').val();
            if((/^.{6,16}$/.test(pw2))){
                return 1;
            }else{
                return 0;
            }
        }
        function regverpwd2(){
            var pw3 = $('#pw3').val();
            if((/^.{6,16}$/.test(pw3))){
                return 1;
            }else{
                return 0;
            }
        }

        function isSamePwd(){
            var pw2 = $('#pw2').val();
            var pw3 = $('#pw3').val();
            if(pw2==pw3){
                return 1;
            }else{
                return 0;
            }
        }
        /*验证码6位数字*/
        function verificate(){
            var verification = $('#verification').val();
            if(!(/^\d{6}$/.test(verification))){
                return 0;
            }else{
                return 1;
            }
        }

        /*弹出小菊花*/
        function showloading(){
            $('.loading-modal').css('display',"block");
            $('.loading').css('display',"block");
        }

        /*隐藏小菊花*/
        function hideloading(){
            $('.loading-modal').css('display',"none");
            $('.loading').css('display',"none");
        }

        /*清空表单*/
        function clearform(){
            $('#phone').val('');
            $('#verification').val('');
            $('#pw').val('');
            $('#pw2').val('');
            $('#pw3').val('');
            if(timer){
                clearInterval(timer);
            }
            $('.query').val('获取验证码');
            isLock = false;
        }

        /*从数组中取随机数*/
        function shuffle(array) {
            var m = array.length,
                    t, i;
            // 如果还剩有元素…
            while (m) {
                // 随机选取一个元素…
                i = Math.floor(Math.random() * m--);
                // 与当前元素进行交换
                t = array[m];
                array[m] = array[i];
                array[i] = t;
            }
            return array;
        }
    })
</script>
<script>
    var len = $('.list').length;
    var dateArr = [];
    var content = [];
    for(var i = 0 ;i < len;i++){
        var date = new Date().getTime()-1000000*(i+1);
        content.push(moment(date).format("M月D日 HH:mm:ss"))
    }
    $('.list').each(function(i){
       $(this).find('.middle em').html(content[i]);
    })
</script>